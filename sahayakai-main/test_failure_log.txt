
> nextn@0.1.0 test
> jest

 ‚ö† Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
FAIL src/__tests__/components/lesson-plan/lesson-plan-input-section.test.tsx
  ‚óè LessonPlanInputSection ‚Ä∫ renders key elements

    TestingLibraryElementError: Unable to find an element with the text: 1. Topic. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"space-y-6"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-2"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-1"[39m
            [36m/>[39m
            [36m<div[39m
              [33maria-describedby[39m=[32m":r0:-form-item-description"[39m
              [33maria-invalid[39m=[32m"false"[39m
              [33mclass[39m=[32m"flex flex-col gap-4"[39m
              [33mid[39m=[32m":r0:-form-item"[39m
            [36m>[39m
              [36m<button[39m
                [33mdata-testid[39m=[32m"mic-input"[39m
              [36m>[39m
                [0mMic[0m
              [36m</button>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex h-10 w-full border focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 bg-white min-h-[140px] text-base border-slate-300 shadow-sm focus:border-primary focus:ring-primary/10 rounded-lg placeholder:text-slate-400 font-normal p-4 resize-none"[39m
                [33mplaceholder[39m=[32m"e.g., A lesson on 'Healthy Food' for grades 1, 2, and 3."[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-4 pt-2 border-t border-slate-100"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white border border-slate-200 rounded-lg p-3 shadow-none"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2 mb-2"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"bg-blue-100 text-blue-700 p-0.5 rounded-md"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"w-3 h-3"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</span>[39m
                [36m<h4[39m
                  [33mclass[39m=[32m"font-semibold text-slate-700 text-xs"[39m
                [36m>[39m
                  [0mQuick Ideas[0m
                [36m</h4>[39m
              [36m</div>[39m
              [36m<button>[39m
                [0mExample[0m
              [36m</button>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-2"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-1.5"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"w-4 h-4 text-[#FF9933]"[39m
                  [33mfill[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 20 20"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"font-semibold text-gray-900 text-sm"[39m
                [36m>[39m
                  [0mQuick Start Templates[0m
                [36m</h3>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"overflow-x-auto pb-1"[39m
              [36m>[39m
                [36m<button>[39m
                  [0mTemplate[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      62 |         );
      63 |
    > 64 |         expect(screen.getByText('1. Topic')).toBeInTheDocument();
         |                       ^
      65 |         expect(screen.getByPlaceholderText(/A lesson on 'Healthy Food'/i)).toBeInTheDocument();
      66 |         expect(screen.getByTestId('mic-input')).toBeInTheDocument();
      67 |         expect(screen.getByText('Generate')).toBeInTheDocument();

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/components/lesson-plan/lesson-plan-input-section.test.tsx:64:23)

FAIL src/__tests__/data/ncert.test.ts
  ‚óè NCERT Mathematics Data ‚Ä∫ Data Integrity ‚Ä∫ should have valid chapters for Grade 6

    expect(received).toBe(expected) // Object.is equality

    Expected: 8
    Received: 12

       9 |             const grade6 = NCERTMathematics.find(g => g.grade === 6);
      10 |             expect(grade6).toBeDefined();
    > 11 |             expect(grade6?.chapters.length).toBe(8);
         |                                             ^
      12 |         });
      13 |
      14 |         it('should include "Knowing Our Numbers" in Grade 6', () => {

      at Object.toBe (src/__tests__/data/ncert.test.ts:11:45)

  ‚óè NCERT Mathematics Data ‚Ä∫ Helper Function: getChaptersForGrade ‚Ä∫ should return flattened chapters with correct subject tag

    expect(received).toBe(expected) // Object.is equality

    Expected: 8
    Received: 12

      34 |
      35 |             // Should be 8
    > 36 |             expect(chapters.length).toBe(8);
         |                                     ^
      37 |
      38 |             // Should have subject 'Mathematics' injected by the helper (index.ts)
      39 |             chapters.forEach(c => {

      at Object.toBe (src/__tests__/data/ncert.test.ts:36:37)

PASS src/__tests__/lib/logger.test.ts
PASS src/lib/db/__tests__/adapter.test.ts
PASS src/__tests__/lib/indian-context.test.ts
PASS src/__tests__/lib/safety.test.ts
PASS src/__tests__/hooks/use-toast.test.ts
FAIL src/__tests__/features/lesson-planner/hooks/use-lesson-plan.test.ts
  ‚óè Test suite failed to run

    ReferenceError: fetch is not defined

      26 |     enableIndexedDbPersistence(db).catch((err) => {
      27 |         if (err.code == 'failed-precondition') {
    > 28 |             // Multiple tabs open, persistence can only be enabled in one tab at a a time.
         |               ^
      29 |             console.warn('Firestore persistence failed: Multiple tabs open');
      30 |         } else if (err.code == 'unimplemented') {
      31 |             // The current browser does not support all of the features required to enable persistence

      at Object.<anonymous> (node_modules/firebase/node_modules/@firebase/auth/src/platform_node/index.ts:33:26)
      at Object.<anonymous> (node_modules/firebase/node_modules/@firebase/auth/dist/node/index.js:5:12)
      at Object.<anonymous> (node_modules/firebase/auth/dist/index.cjs.js:5:12)
      at Object.<anonymous> (src/lib/firebase.ts:28:15)
      at Object.<anonymous> (src/features/lesson-planner/hooks/use-lesson-plan.ts:22:19)
      at Object.<anonymous> (src/__tests__/features/lesson-planner/hooks/use-lesson-plan.test.ts:35:24)

FAIL src/__tests__/components/feedback-dialog.test.tsx
  ‚óè Test suite failed to run

    Configuration error:

    Could not locate module jose mapped as:
    /Users/sargupta/SahayakAIV2/sahayakai/sahayakai-main/node_modules/jose/dist/node/cjs/index.js.

    Please check your configuration for these entries:
    {
      "moduleNameMapper": {
        "/^jose$/": "/Users/sargupta/SahayakAIV2/sahayakai/sahayakai-main/node_modules/jose/dist/node/cjs/index.js"
      },
      "resolver": undefined
    }

      26 |     console.warn(`[getSecret] Could not fetch ${secretName}: ${error.message}`);
      27 |     throw error;
    > 28 |   }
         |    ^
      29 | }
      30 |
      31 | let firebaseInitialized = false;

      at createNoMappedModuleFoundError (node_modules/jest-resolve/build/index.js:1117:17)
      at Object.<anonymous> (node_modules/jwks-rsa/src/utils.js:1:14)
      at Object.<anonymous> (node_modules/jwks-rsa/src/JwksClient.js:2:33)
      at Object.<anonymous> (node_modules/jwks-rsa/src/index.js:1:24)
      at Object.<anonymous> (node_modules/firebase-admin/lib/utils/jwt.js:24:14)
      at Object.<anonymous> (node_modules/firebase-admin/lib/auth/token-verifier.js:26:15)
      at Object.<anonymous> (node_modules/firebase-admin/lib/auth/base-auth.js:26:26)
      at Object.<anonymous> (node_modules/firebase-admin/lib/auth/tenant-manager.js:23:21)
      at Object.<anonymous> (node_modules/firebase-admin/lib/auth/auth.js:22:26)
      at Object.<anonymous> (node_modules/firebase-admin/lib/auth/index.js:27:16)
      at Object.<anonymous> (src/lib/firebase-admin.ts:28:15)
      at Object.<anonymous> (src/app/actions/feedback.ts:12:24)
      at Object.<anonymous> (src/components/feedback-dialog.tsx:18:19)
      at Object.<anonymous> (src/__tests__/components/feedback-dialog.test.tsx:37:25)

FAIL src/__tests__/app/page.test.tsx
  ‚óè Test suite failed to run

    ReferenceError: fetch is not defined

      26 |     enableIndexedDbPersistence(db).catch((err) => {
      27 |         if (err.code == 'failed-precondition') {
    > 28 |             // Multiple tabs open, persistence can only be enabled in one tab at a a time.
         |               ^
      29 |             console.warn('Firestore persistence failed: Multiple tabs open');
      30 |         } else if (err.code == 'unimplemented') {
      31 |             // The current browser does not support all of the features required to enable persistence

      at Object.<anonymous> (node_modules/firebase/node_modules/@firebase/auth/src/platform_node/index.ts:33:26)
      at Object.<anonymous> (node_modules/firebase/node_modules/@firebase/auth/dist/node/index.js:5:12)
      at Object.<anonymous> (node_modules/firebase/auth/dist/index.cjs.js:5:12)
      at Object.<anonymous> (src/lib/firebase.ts:28:15)
      at Object.<anonymous> (src/app/page.tsx:27:19)
      at Object.<anonymous> (src/__tests__/app/page.test.tsx:51:54)

--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------
File                            | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                
--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------
All files                       |   54.78 |    69.73 |   58.62 |   54.78 |                                                                  
 app                            |       0 |        0 |       0 |       0 |                                                                  
  page.tsx                      |       0 |        0 |       0 |       0 | 1-283                                                            
 components                     |       0 |        0 |       0 |       0 |                                                                  
  feedback-dialog.tsx           |       0 |        0 |       0 |       0 | 1-132                                                            
 components/lesson-plan         |     100 |       25 |     100 |     100 |                                                                  
  lesson-plan-input-section.tsx |     100 |       25 |     100 |     100 | 53-98                                                            
 data/ncert                     |   98.75 |      100 |   33.33 |   98.75 |                                                                  
  english.ts                    |     100 |      100 |     100 |     100 |                                                                  
  hindi.ts                      |     100 |      100 |     100 |     100 |                                                                  
  index.ts                      |      90 |      100 |   33.33 |      90 | 71-72,75-80                                                      
  it.ts                         |     100 |      100 |     100 |     100 |                                                                  
  kannada.ts                    |     100 |      100 |     100 |     100 |                                                                  
  mathematics.ts                |     100 |      100 |     100 |     100 |                                                                  
  sanskrit.ts                   |     100 |      100 |     100 |     100 |                                                                  
  science.ts                    |     100 |      100 |     100 |     100 |                                                                  
  social-studies.ts             |     100 |      100 |     100 |     100 |                                                                  
 features/lesson-planner/hooks  |       0 |        0 |       0 |       0 |                                                                  
  use-lesson-plan.ts            |       0 |        0 |       0 |       0 | 1-486                                                            
 hooks                          |   82.47 |    68.42 |      70 |   82.47 |                                                                  
  use-toast.ts                  |   82.47 |    68.42 |      70 |   82.47 | 63-64,67-71,86-91,101-104,114,119-128,149-152,162-163            
 lib                            |   83.11 |     73.8 |   66.66 |   83.11 |                                                                  
  indian-context.ts             |     100 |      100 |     100 |     100 |                                                                  
  logger.ts                     |   57.44 |    65.38 |      50 |   57.44 | 32-57,60-67,81-82,84-85,93,98-99,103-106,111-112,120-121,128-138 
  safety.ts                     |   93.22 |    83.33 |     100 |   93.22 | 34-37                                                            
--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------
Jest: "global" coverage threshold for statements (70%) not met: 54.78%
Jest: "global" coverage threshold for branches (70%) not met: 69.73%
Jest: "global" coverage threshold for lines (70%) not met: 54.78%
Jest: "global" coverage threshold for functions (70%) not met: 58.62%
Test Suites: 5 failed, 5 passed, 10 total
Tests:       3 failed, 29 passed, 32 total
Snapshots:   0 total
Time:        3.938 s
Ran all test suites.
