
> nextn@0.1.0 test
> jest --no-cache

 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
 ⚠ Mismatching @next/swc version, detected: 15.5.7 while Next.js is on 15.5.11. Please ensure these match
PASS src/__tests__/lib/indian-context.test.ts
PASS src/lib/db/__tests__/adapter.test.ts
PASS src/__tests__/lib/logger.test.ts
PASS src/__tests__/lib/safety.test.ts
PASS src/__tests__/components/lesson-plan/lesson-plan-input-section.test.tsx
PASS src/__tests__/components/feedback-dialog.test.tsx
PASS src/__tests__/data/ncert.test.ts
PASS src/__tests__/hooks/use-toast.test.ts
FAIL src/__tests__/app/page.test.tsx
  ● Console

    console.warn
      [2026-02-11T20:36:08.664Z]  @firebase/firestore: Firestore (11.10.0): enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.

      24 | // Enable Offline Persistence (Client-side only)
      25 | if (typeof window !== 'undefined') {
    > 26 |     enableIndexedDbPersistence(db).catch((err) => {
         |                               ^
      27 |         if (err.code == 'failed-precondition') {
      28 |             // Multiple tabs open, persistence can only be enabled in one tab at a a time.
      29 |             console.warn('Firestore persistence failed: Multiple tabs open');

      at Logger.defaultLogHandler [as _logHandler] (node_modules/@firebase/logger/src/logger.ts:115:57)
      at Logger.warn (node_modules/@firebase/logger/src/logger.ts:206:10)
      at logWarn (node_modules/@firebase/firestore/src/util/log.ts:69:15)
      at enableIndexedDbPersistence (node_modules/@firebase/firestore/src/api/database.ts:375:3)
      at Object.<anonymous> (src/lib/firebase.ts:26:31)
      at Object.<anonymous> (src/app/page.tsx:27:19)
      at Object.<anonymous> (src/__tests__/app/page.test.tsx:90:54)

    console.log
      DEBUG: Page.tsx Component Check: {
        Form: 'function',
        AutoCompleteInput: 'function',
        MicrophoneInput: 'function',
        Link: 'object',
        Loader2: 'function',
        Sparkles: 'function'
      }

      at Object.log (src/app/page.tsx:30:9)

  ● Home Page › renders the hero section with greeting

    ReferenceError: mockProcessAgentRequest is not defined

      68 |         (useRouter as jest.Mock).mockReturnValue({ push: mockPush });
      69 |         // Reset the specific mock implementation if needed, but the factory holds it
    > 70 |         mockProcessAgentRequest.mockClear();
         |         ^
      71 |         mockProcessAgentRequest.mockResolvedValue({
      72 |             success: true,
      73 |             result: { action: 'NAVIGATE', url: '/lesson-plan?topic=Photosynthesis' }

      at Object.mockProcessAgentRequest (src/__tests__/app/page.test.tsx:70:9)

  ● Home Page › renders quick action cards

    ReferenceError: mockProcessAgentRequest is not defined

      68 |         (useRouter as jest.Mock).mockReturnValue({ push: mockPush });
      69 |         // Reset the specific mock implementation if needed, but the factory holds it
    > 70 |         mockProcessAgentRequest.mockClear();
         |         ^
      71 |         mockProcessAgentRequest.mockResolvedValue({
      72 |             success: true,
      73 |             result: { action: 'NAVIGATE', url: '/lesson-plan?topic=Photosynthesis' }

      at Object.mockProcessAgentRequest (src/__tests__/app/page.test.tsx:70:9)

  ● Home Page › navigates on form submission

    ReferenceError: mockProcessAgentRequest is not defined

      68 |         (useRouter as jest.Mock).mockReturnValue({ push: mockPush });
      69 |         // Reset the specific mock implementation if needed, but the factory holds it
    > 70 |         mockProcessAgentRequest.mockClear();
         |         ^
      71 |         mockProcessAgentRequest.mockResolvedValue({
      72 |             success: true,
      73 |             result: { action: 'NAVIGATE', url: '/lesson-plan?topic=Photosynthesis' }

      at Object.mockProcessAgentRequest (src/__tests__/app/page.test.tsx:70:9)

  ● Home Page › handles microphone input

    ReferenceError: mockProcessAgentRequest is not defined

      68 |         (useRouter as jest.Mock).mockReturnValue({ push: mockPush });
      69 |         // Reset the specific mock implementation if needed, but the factory holds it
    > 70 |         mockProcessAgentRequest.mockClear();
         |         ^
      71 |         mockProcessAgentRequest.mockResolvedValue({
      72 |             success: true,
      73 |             result: { action: 'NAVIGATE', url: '/lesson-plan?topic=Photosynthesis' }

      at Object.mockProcessAgentRequest (src/__tests__/app/page.test.tsx:70:9)

PASS src/__tests__/features/lesson-planner/hooks/use-lesson-plan.test.ts
  ● Console

    console.warn
      [2026-02-11T20:36:08.680Z]  @firebase/firestore: Firestore (11.10.0): enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.

      24 | // Enable Offline Persistence (Client-side only)
      25 | if (typeof window !== 'undefined') {
    > 26 |     enableIndexedDbPersistence(db).catch((err) => {
         |                               ^
      27 |         if (err.code == 'failed-precondition') {
      28 |             // Multiple tabs open, persistence can only be enabled in one tab at a a time.
      29 |             console.warn('Firestore persistence failed: Multiple tabs open');

      at Logger.defaultLogHandler [as _logHandler] (node_modules/@firebase/logger/src/logger.ts:115:57)
      at Logger.warn (node_modules/@firebase/logger/src/logger.ts:206:10)
      at logWarn (node_modules/@firebase/firestore/src/util/log.ts:69:15)
      at enableIndexedDbPersistence (node_modules/@firebase/firestore/src/api/database.ts:375:3)
      at Object.<anonymous> (src/lib/firebase.ts:26:31)
      at Object.<anonymous> (src/features/lesson-planner/hooks/use-lesson-plan.ts:22:19)
      at Object.<anonymous> (src/__tests__/features/lesson-planner/hooks/use-lesson-plan.test.ts:64:24)

    console.warn
      [Performance] startAIGeneration was not called

      27 |     const endAIGeneration = useCallback((data: Partial<AIGenData>) => {
      28 |         if (!startTimeRef.current) {
    > 29 |             console.warn('[Performance] startAIGeneration was not called');
         |                     ^
      30 |             return;
      31 |         }
      32 |

      at warn (src/hooks/use-performance-tracking.ts:29:21)
      at Object.endAIGeneration [as onSubmit] (src/features/lesson-planner/hooks/use-lesson-plan.ts:236:21)
      at src/__tests__/features/lesson-planner/hooks/use-lesson-plan.test.ts:147:13

--------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------
File                            | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                     
--------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------
All files                       |   76.46 |       61 |   68.18 |   76.46 |                                                                                                                       
 app                            |   13.55 |        0 |       0 |   13.55 |                                                                                                                       
  page.tsx                      |   13.55 |        0 |       0 |   13.55 | 41-295                                                                                                                
 components                     |    90.9 |       80 |   71.42 |    90.9 |                                                                                                                       
  feedback-dialog.tsx           |    90.9 |       80 |   71.42 |    90.9 | 44-45,56-61,79-82                                                                                                     
 components/lesson-plan         |     100 |       25 |     100 |     100 |                                                                                                                       
  lesson-plan-input-section.tsx |     100 |       25 |     100 |     100 | 53-98                                                                                                                 
 data/ncert                     |   98.75 |      100 |   33.33 |   98.75 |                                                                                                                       
  english.ts                    |     100 |      100 |     100 |     100 |                                                                                                                       
  hindi.ts                      |     100 |      100 |     100 |     100 |                                                                                                                       
  index.ts                      |      90 |      100 |   33.33 |      90 | 71-72,75-80                                                                                                           
  it.ts                         |     100 |      100 |     100 |     100 |                                                                                                                       
  kannada.ts                    |     100 |      100 |     100 |     100 |                                                                                                                       
  mathematics.ts                |     100 |      100 |     100 |     100 |                                                                                                                       
  sanskrit.ts                   |     100 |      100 |     100 |     100 |                                                                                                                       
  science.ts                    |     100 |      100 |     100 |     100 |                                                                                                                       
  social-studies.ts             |     100 |      100 |     100 |     100 |                                                                                                                       
 features/lesson-planner/hooks  |   68.31 |    51.42 |      80 |   68.31 |                                                                                                                       
  use-lesson-plan.ts            |   68.31 |    51.42 |      80 |   68.31 | 68-84,107-108,123-134,136-137,150-190,192-196,261-262,275-287,289-290,295-316,333-334,349-351,357-363,401-405,420-438 
 hooks                          |   82.47 |    68.42 |      70 |   82.47 |                                                                                                                       
  use-toast.ts                  |   82.47 |    68.42 |      70 |   82.47 | 63-64,67-71,86-91,101-104,114,119-128,149-152,162-163                                                                 
 lib                            |   83.11 |     73.8 |   66.66 |   83.11 |                                                                                                                       
  indian-context.ts             |     100 |      100 |     100 |     100 |                                                                                                                       
  logger.ts                     |   57.44 |    65.38 |      50 |   57.44 | 32-57,60-67,81-82,84-85,93,98-99,103-106,111-112,120-121,128-138                                                      
  safety.ts                     |   93.22 |    83.33 |     100 |   93.22 | 34-37                                                                                                                 
--------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------

Test Suites: 1 failed, 9 passed, 10 total
Tests:       4 failed, 45 passed, 49 total
Snapshots:   0 total
Time:        3.731 s
Ran all test suites.
